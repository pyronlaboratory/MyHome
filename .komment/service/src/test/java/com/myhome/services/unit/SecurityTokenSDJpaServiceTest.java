{"name":"SecurityTokenSDJpaServiceTest.java","path":"service/src/test/java/com/myhome/services/unit/SecurityTokenSDJpaServiceTest.java","content":{"structured":{"description":"A SecurityTokenSDJpaService class that creates security tokens for password reset and email confirmation. The code includes annotations for testing and utilizes Spring Data JPA and Mockito for dependency injection and mocking, respectively. The createPasswordResetToken and createEmailConfirmToken methods create security tokens with unique identifiers, expiration dates, and token types, while the SecurityTokenSDJpaService class also verifies that the created tokens are saved in a repository.","image":"<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\"\n \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<!-- Generated by graphviz version 2.43.0 (0)\n -->\n<!-- Title: com.myhome.domain.SecurityToken Pages: 1 -->\n<svg width=\"187pt\" height=\"148pt\"\n viewBox=\"0.00 0.00 187.00 148.00\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n<g id=\"graph0\" class=\"graph\" transform=\"scale(1 1) rotate(0) translate(4 144)\">\n<title>com.myhome.domain.SecurityToken</title>\n<!-- Node1 -->\n<g id=\"Node000001\" class=\"node\">\n<title>Node1</title>\n<g id=\"a_Node000001\"><a xlink:title=\" \">\n<polygon fill=\"#999999\" stroke=\"#666666\" points=\"173,-30 6,-30 6,0 173,0 173,-30\"/>\n<text text-anchor=\"start\" x=\"14\" y=\"-18\" font-family=\"Helvetica,sans-Serif\" font-size=\"10.00\">com.myhome.domain.Security</text>\n<text text-anchor=\"middle\" x=\"89.5\" y=\"-7\" font-family=\"Helvetica,sans-Serif\" font-size=\"10.00\">Token</text>\n</a>\n</g>\n</g>\n<!-- Node2 -->\n<g id=\"Node000002\" class=\"node\">\n<title>Node2</title>\n<g id=\"a_Node000002\"><a xlink:href=\"classcom_1_1myhome_1_1domain_1_1BaseEntity.html\" target=\"_top\" xlink:title=\" \">\n<polygon fill=\"white\" stroke=\"#666666\" points=\"179,-85 0,-85 0,-66 179,-66 179,-85\"/>\n<text text-anchor=\"middle\" x=\"89.5\" y=\"-73\" font-family=\"Helvetica,sans-Serif\" font-size=\"10.00\">com.myhome.domain.BaseEntity</text>\n</a>\n</g>\n</g>\n<!-- Node2&#45;&gt;Node1 -->\n<g id=\"edge1_Node000001_Node000002\" class=\"edge\">\n<title>Node2&#45;&gt;Node1</title>\n<g id=\"a_edge1_Node000001_Node000002\"><a xlink:title=\" \">\n<path fill=\"none\" stroke=\"#63b8ff\" d=\"M89.5,-55.65C89.5,-47.36 89.5,-37.78 89.5,-30.11\"/>\n<polygon fill=\"#63b8ff\" stroke=\"#63b8ff\" points=\"86,-55.87 89.5,-65.87 93,-55.87 86,-55.87\"/>\n</a>\n</g>\n</g>\n<!-- Node3 -->\n<g id=\"Node000003\" class=\"node\">\n<title>Node3</title>\n<g id=\"a_Node000003\"><a xlink:title=\" \">\n<polygon fill=\"white\" stroke=\"#666666\" points=\"126.5,-140 52.5,-140 52.5,-121 126.5,-121 126.5,-140\"/>\n<text text-anchor=\"middle\" x=\"89.5\" y=\"-128\" font-family=\"Helvetica,sans-Serif\" font-size=\"10.00\">Serializable</text>\n</a>\n</g>\n</g>\n<!-- Node3&#45;&gt;Node2 -->\n<g id=\"edge2_Node000002_Node000003\" class=\"edge\">\n<title>Node3&#45;&gt;Node2</title>\n<g id=\"a_edge2_Node000002_Node000003\"><a xlink:title=\" \">\n<path fill=\"none\" stroke=\"#63b8ff\" d=\"M89.5,-110.66C89.5,-101.93 89.5,-91.99 89.5,-85.09\"/>\n<polygon fill=\"#63b8ff\" stroke=\"#63b8ff\" points=\"86,-110.75 89.5,-120.75 93,-110.75 86,-110.75\"/>\n</a>\n</g>\n</g>\n</g>\n</svg>\n","items":[{"id":"08775edf-cf6e-7eba-8840-dcdc3f652a01","ancestors":[],"type":"function","description":"TODO","name":"SecurityTokenSDJpaServiceTest","code":"public class SecurityTokenSDJpaServiceTest {\n\n  private final Duration TEST_TOKEN_LIFETIME_SECONDS = Duration.ofDays(1);\n\n  @Mock\n  private SecurityTokenRepository securityTokenRepository;\n\n  @InjectMocks\n  private SecurityTokenSDJpaService securityTokenSDJpaService;\n\n  @BeforeEach\n  private void init() {\n    MockitoAnnotations.initMocks(this);\n    ReflectionTestUtils.setField(securityTokenSDJpaService, \"passResetTokenTime\",\n        TEST_TOKEN_LIFETIME_SECONDS);\n    ReflectionTestUtils.setField(securityTokenSDJpaService, \"emailConfirmTokenTime\",\n        TEST_TOKEN_LIFETIME_SECONDS);\n  }\n\n  @Test\n  void createSecurityToken() {\n    // given\n    User user = new User();\n    user.setUserId(TestUtils.General.generateUniqueId());\n    SecurityTokenType testTokenType = SecurityTokenType.RESET;\n    when(securityTokenRepository.save(any()))\n        .then(returnsFirstArg());\n\n    // when\n    SecurityToken actualSecurityToken = securityTokenSDJpaService.createPasswordResetToken(user);\n    LocalDate creationDate = actualSecurityToken.getCreationDate();\n    LocalDate expiryDate = actualSecurityToken.getExpiryDate();\n    Duration lifetime = Duration.between(creationDate.atStartOfDay(), expiryDate.atStartOfDay());\n\n    // then\n    assertEquals(actualSecurityToken.getTokenType(), testTokenType);\n    assertTrue(creationDate.isBefore(expiryDate));\n    assertEquals(lifetime, TEST_TOKEN_LIFETIME_SECONDS);\n    assertEquals(user, actualSecurityToken.getTokenOwner());\n    assertNotNull(actualSecurityToken.getToken());\n    verify(securityTokenRepository).save(any());\n  }\n\n  @Test\n  void createPasswordResetToken() {\n    // given\n    User user = new User();\n    user.setUserId(TestUtils.General.generateUniqueId());\n    when(securityTokenRepository.save(any()))\n        .then(returnsFirstArg());\n\n    // when\n    SecurityToken actualSecurityToken = securityTokenSDJpaService.createPasswordResetToken(user);\n    LocalDate creationDate = actualSecurityToken.getCreationDate();\n    LocalDate expiryDate = actualSecurityToken.getExpiryDate();\n    Duration lifetime = Duration.between(creationDate.atStartOfDay(), expiryDate.atStartOfDay());\n\n    // then\n    assertEquals(actualSecurityToken.getTokenType(), SecurityTokenType.RESET);\n    assertTrue(creationDate.isBefore(expiryDate));\n    assertEquals(lifetime, TEST_TOKEN_LIFETIME_SECONDS);\n    assertEquals(user, actualSecurityToken.getTokenOwner());\n    assertNotNull(actualSecurityToken.getToken());\n    verify(securityTokenRepository).save(any());\n  }\n\n  @Test\n  void createEmailConfirmToken() {\n    // given\n    User user = new User();\n    user.setUserId(TestUtils.General.generateUniqueId());\n    when(securityTokenRepository.save(any()))\n        .then(returnsFirstArg());\n\n    // when\n    SecurityToken actualSecurityToken = securityTokenSDJpaService.createEmailConfirmToken(user);\n    LocalDate creationDate = actualSecurityToken.getCreationDate();\n    LocalDate expiryDate = actualSecurityToken.getExpiryDate();\n    Duration lifetime = Duration.between(creationDate.atStartOfDay(), expiryDate.atStartOfDay());\n\n    // then\n    assertEquals(actualSecurityToken.getTokenType(), SecurityTokenType.EMAIL_CONFIRM);\n    assertTrue(creationDate.isBefore(expiryDate));\n    assertEquals(lifetime, TEST_TOKEN_LIFETIME_SECONDS);\n    assertEquals(user, actualSecurityToken.getTokenOwner());\n    assertNotNull(actualSecurityToken.getToken());\n    verify(securityTokenRepository).save(any());\n  }\n\n}","location":{"start":27,"insert":27,"offset":" ","indent":0},"item_type":"class","length":90},{"id":"c96b0075-82cb-eb99-5b4c-c2d6331bb02b","ancestors":["08775edf-cf6e-7eba-8840-dcdc3f652a01"],"type":"function","description":"initializes MockitoAnnotations and sets field values for a `securityTokenSDJpaService`.","params":[],"usage":{"language":"java","code":"@BeforeEach\n  private void init() {\n    MockitoAnnotations.initMocks(this);\n    ReflectionTestUtils.setField(securityTokenSDJpaService, \"passResetTokenTime\",\n        TEST_TOKEN_LIFETIME_SECONDS);\n    ReflectionTestUtils.setField(securityTokenSDJpaService, \"emailConfirmTokenTime\",\n        TEST_TOKEN_LIFETIME_SECONDS);\n  }\n","description":""},"name":"init","code":"@BeforeEach\n  private void init() {\n    MockitoAnnotations.initMocks(this);\n    ReflectionTestUtils.setField(securityTokenSDJpaService, \"passResetTokenTime\",\n        TEST_TOKEN_LIFETIME_SECONDS);\n    ReflectionTestUtils.setField(securityTokenSDJpaService, \"emailConfirmTokenTime\",\n        TEST_TOKEN_LIFETIME_SECONDS);\n  }","location":{"start":37,"insert":37,"offset":" ","indent":2},"item_type":"method","length":8},{"id":"42fa6788-af2c-e7a2-084a-5ceadb30d36c","ancestors":["08775edf-cf6e-7eba-8840-dcdc3f652a01"],"type":"function","description":"creates a new security token for a user based on specified parameters, saves it to the repository, and returns the token object.","params":[],"usage":{"language":"java","code":"@Test\n  void createSecurityToken() {\n    // given\n    User user = new User();\n    user.setUserId(TestUtils.General.generateUniqueId());\n    SecurityTokenType testTokenType = SecurityTokenType.RESET;\n    when(securityTokenRepository.save(any()))\n        .then(returnsFirstArg());\n\n    // when\n    SecurityToken actualSecurityToken = securityTokenSDJpaService.createPasswordResetToken(user);\n    LocalDate creationDate = actualSecurityToken.getCreationDate();\n    LocalDate expiryDate = actualSecurityToken.getExpiryDate();\n    Duration lifetime = Duration.between(creationDate.atStartOfDay(), expiryDate.atStartOfDay());\n\n    // then\n    assertEquals(actualSecurityToken.getTokenType(), testTokenType);\n    assertTrue(creationDate.isBefore(expiryDate));\n    assertEquals(lifetime, TEST_TOKEN_LIFETIME_SECONDS);\n    assertEquals(user, actualSecurityToken.getTokenOwner());\n    assertNotNull(actualSecurityToken.getToken());\n    verify(securityTokenRepository).save(any());\n  }\n","description":""},"name":"createSecurityToken","code":"@Test\n  void createSecurityToken() {\n    // given\n    User user = new User();\n    user.setUserId(TestUtils.General.generateUniqueId());\n    SecurityTokenType testTokenType = SecurityTokenType.RESET;\n    when(securityTokenRepository.save(any()))\n        .then(returnsFirstArg());\n\n    // when\n    SecurityToken actualSecurityToken = securityTokenSDJpaService.createPasswordResetToken(user);\n    LocalDate creationDate = actualSecurityToken.getCreationDate();\n    LocalDate expiryDate = actualSecurityToken.getExpiryDate();\n    Duration lifetime = Duration.between(creationDate.atStartOfDay(), expiryDate.atStartOfDay());\n\n    // then\n    assertEquals(actualSecurityToken.getTokenType(), testTokenType);\n    assertTrue(creationDate.isBefore(expiryDate));\n    assertEquals(lifetime, TEST_TOKEN_LIFETIME_SECONDS);\n    assertEquals(user, actualSecurityToken.getTokenOwner());\n    assertNotNull(actualSecurityToken.getToken());\n    verify(securityTokenRepository).save(any());\n  }","location":{"start":46,"insert":46,"offset":" ","indent":2},"item_type":"method","length":23},{"id":"ca5f3a76-032b-e897-1a43-3fd94e09d1ae","ancestors":["08775edf-cf6e-7eba-8840-dcdc3f652a01"],"type":"function","description":"generates a security token for a user to reset their password, sets its expiration date and lifetime, and saves it to the repository.","params":[],"usage":{"language":"java","code":"@Test\n  void createPasswordResetToken() {\n    // given\n    User user = new User();\n    user.setUserId(TestUtils.General.generateUniqueId());\n     when(securityTokenRepository.save(any()))\n        .then(returnsFirstArg());\n\n    // when\n    SecurityToken actualSecurityToken = securityTokenSDJpaService.createPasswordResetToken(user);\n    LocalDate creationDate = actualSecurityToken.getCreationDate();\n    LocalDate expiryDate = actualSecurityToken.getExpiryDate();\n    Duration lifetime = Duration.between(creationDate.atStartOfDay(), expiryDate.atStartOfDay());\n\n    // then\n    assertEquals(actualSecurityToken.getTokenType(), SecurityTokenType.RESET);\n    assertTrue(creationDate.isBefore(expiryDate));\n    assertEquals(lifetime, TEST_TOKEN_LIFETIME_SECONDS);\n    assertEquals(user, actualSecurityToken.getTokenOwner());\n    assertNotNull(actualSecurityToken.getToken());\n    verify(securityTokenRepository).save(any());\n  }\n","description":"\nThe test creates a user and uses the createPasswordResetToken method to create a password reset token for the user. Then, it verifies that the returned security token has the correct type (RESET), creation and expiry dates are correct and match the expected values, and the token owner matches the created user. Additionally, it asserts that the token is saved in the securityTokenRepository by mocking the save method to return the first argument passed."},"name":"createPasswordResetToken","code":"@Test\n  void createPasswordResetToken() {\n    // given\n    User user = new User();\n    user.setUserId(TestUtils.General.generateUniqueId());\n    when(securityTokenRepository.save(any()))\n        .then(returnsFirstArg());\n\n    // when\n    SecurityToken actualSecurityToken = securityTokenSDJpaService.createPasswordResetToken(user);\n    LocalDate creationDate = actualSecurityToken.getCreationDate();\n    LocalDate expiryDate = actualSecurityToken.getExpiryDate();\n    Duration lifetime = Duration.between(creationDate.atStartOfDay(), expiryDate.atStartOfDay());\n\n    // then\n    assertEquals(actualSecurityToken.getTokenType(), SecurityTokenType.RESET);\n    assertTrue(creationDate.isBefore(expiryDate));\n    assertEquals(lifetime, TEST_TOKEN_LIFETIME_SECONDS);\n    assertEquals(user, actualSecurityToken.getTokenOwner());\n    assertNotNull(actualSecurityToken.getToken());\n    verify(securityTokenRepository).save(any());\n  }","location":{"start":70,"insert":70,"offset":" ","indent":2},"item_type":"method","length":22},{"id":"ad71f703-b1c5-fda6-f443-e7563c3f1a3d","ancestors":["08775edf-cf6e-7eba-8840-dcdc3f652a01"],"type":"function","description":"creates an email confirm token for a given user using a JPA service, saving it to a repository and returning the token.","params":[],"usage":{"language":"java","code":"@Test\n  void createEmailConfirmToken() {\n    // given\n    User user = new User();\n    user.setUserId(TestUtils.General.generateUniqueId());\n    when(securityTokenRepository.save(any()))\n        .then(returnsFirstArg());\n\n    // when\n    SecurityToken actualSecurityToken = securityTokenSDJpaService.createEmailConfirmToken(user);\n    LocalDate creationDate = actualSecurityToken.getCreationDate();\n    LocalDate expiryDate = actualSecurityToken.getExpiryDate();\n    Duration lifetime = Duration.between(creationDate.atStartOfDay(), expiryDate.atStartOfDay());\n\n    // then\n    assertEquals(actualSecurityToken.getTokenType(), SecurityTokenType.EMAIL_CONFIRM);\n    assertTrue(creationDate.isBefore(expiryDate));\n    assertEquals(lifetime, TEST_TOKEN_LIFETIME_SECONDS);\n    assertEquals(user, actualSecurityToken.getTokenOwner());\n    assertNotNull(actualSecurityToken.getToken());\n    verify(securityTokenRepository).save(any());\n  }\n","description":""},"name":"createEmailConfirmToken","code":"@Test\n  void createEmailConfirmToken() {\n    // given\n    User user = new User();\n    user.setUserId(TestUtils.General.generateUniqueId());\n    when(securityTokenRepository.save(any()))\n        .then(returnsFirstArg());\n\n    // when\n    SecurityToken actualSecurityToken = securityTokenSDJpaService.createEmailConfirmToken(user);\n    LocalDate creationDate = actualSecurityToken.getCreationDate();\n    LocalDate expiryDate = actualSecurityToken.getExpiryDate();\n    Duration lifetime = Duration.between(creationDate.atStartOfDay(), expiryDate.atStartOfDay());\n\n    // then\n    assertEquals(actualSecurityToken.getTokenType(), SecurityTokenType.EMAIL_CONFIRM);\n    assertTrue(creationDate.isBefore(expiryDate));\n    assertEquals(lifetime, TEST_TOKEN_LIFETIME_SECONDS);\n    assertEquals(user, actualSecurityToken.getTokenOwner());\n    assertNotNull(actualSecurityToken.getToken());\n    verify(securityTokenRepository).save(any());\n  }","location":{"start":93,"insert":93,"offset":" ","indent":2},"item_type":"method","length":22}]}}}